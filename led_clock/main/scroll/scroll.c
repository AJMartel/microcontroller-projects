#include "scroll.h"

static uint8_t _buf[255];
static uint8_t _l;

static uint8_t _ascii[] = {
	0x00, 0x00, 0x00, // sp
	0x00, 0xf4, 0x00, // !
	0xc0, 0x00, 0xc0, // "
	0x7c, 0x28, 0x7c, // #
	0x28, 0xfc, 0x50, // $
	0x98, 0x20, 0xc8, // %
	0x58, 0xb4, 0x4c, // &
	0x00, 0xc0, 0x00, // '
	0x7e, 0x81, 0x00, // (
	0x00, 0x81, 0x7e, // )
	0x28, 0x10, 0x28, // *
	0x10, 0x38, 0x10, // +
	0x02, 0x04, 0x00, // ,
	0x10, 0x10, 0x10, // -
	0x00, 0x04, 0x00, // .
	0x0c, 0x30, 0xc0, // /
	0x1c, 0x24, 0x38, // 0
	0x14, 0x3c, 0x04, // 1
	0x24, 0x2c, 0x14, // 2
	0x25, 0x2d, 0x16, // 3
	0x0c, 0x14, 0x3f, // 4
	0x39, 0x29, 0x26, // 5
	0x38, 0x64, 0x98, // 6
	0x20, 0x27, 0x38, // 7
	0x58, 0xa4, 0x58, // 8
	0x18, 0x25, 0x1e, // 9
	0x00, 0x24, 0x00, // :
	0x02, 0x24, 0x00, // ;
	0x10, 0x28, 0x00, // <
	0x50, 0x50, 0x50, // =
	0x00, 0x28, 0x10, // >
	0x40, 0x94, 0x60, // ?
	0x78, 0xb4, 0x74, // @
	0x7c, 0x90, 0x7c, // A
	0xfc, 0xa4, 0x58, // B
	0x78, 0x84, 0x84, // C
	0xfc, 0x84, 0x78, // D
	0xfc, 0xa4, 0x84, // E
	0xfc, 0xa0, 0x80, // F
	0x78, 0x84, 0x9c, // G
	0xfc, 0x20, 0xfc, // H
	0x84, 0xfc, 0x84, // I
	0x04, 0x84, 0xf8, // J
	0xfc, 0x10, 0x6c, // K
	0xfc, 0x04, 0x04, // L
	0xfc, 0x60, 0xfc, // M
	0xfc, 0x80, 0x7c, // N
	0x78, 0x84, 0x78, // O
	0xfc, 0x90, 0x60, // P
	0x78, 0x84, 0x7a, // Q
	0xfc, 0x90, 0x6c, // R
	0x44, 0xa4, 0x98, // S
	0x80, 0xfc, 0x80, // T
	0xf8, 0x04, 0xfc, // U
	0xf8, 0x04, 0xf8, // V
	0xfc, 0x18, 0xfc, // W
	0xcc, 0x30, 0xcc, // X
	0xe0, 0x1c, 0xe0, // Y
	0x9c, 0xa4, 0xc4, // Z
	0xfc, 0x84, 0x00, // [
	0xc0, 0x30, 0x0c, // backslash
	0x00, 0x84, 0xfc, // ]
	0x40, 0x80, 0x40, // ^
	0x04, 0x04, 0x04, // _
	0x00, 0x80, 0x40, // `
	0x18, 0x24, 0x3c, // a
	0xfc, 0x24, 0x18, // b
	0x18, 0x24, 0x24, // c
	0x18, 0x24, 0xfc, // d
	0x18, 0x2c, 0x34, // e
	0x20, 0x7c, 0xa0, // f
	0x19, 0x25, 0x3e, // g
	0xfc, 0x20, 0x1c, // h
	0x20, 0xbc, 0x04, // i
	0x01, 0x21, 0xbe, // j
	0xfc, 0x18, 0x24, // k
	0x80, 0xfc, 0x04, // l
	0x3c, 0x10, 0x3c, // m
	0x3c, 0x20, 0x1c, // n
	0x18, 0x24, 0x18, // o
	0x3f, 0x24, 0x18, // p
	0x18, 0x24, 0x3f, // q
	0x3c, 0x10, 0x20, // r
	0x14, 0x34, 0x28, // s
	0x20, 0xf8, 0x24, // t
	0x38, 0x04, 0x3c, // u
	0x38, 0x0c, 0x38, // v
	0x3c, 0x08, 0x3c, // w
	0x24, 0x18, 0x24, // x
	0x39, 0x05, 0x3e, // y
	0x2c, 0x34, 0x34, // z
	0x30, 0xcc, 0x84, // {
	0x00, 0xfc, 0x00, // |
	0x84, 0xcc, 0x30, // }
	0x30, 0x20, 0x60 // ~
};

void scroll_update(char s[], uint8_t l) {
	_l = l * 4;
	for (uint8_t i = 0; i < l; i++) {
		for (uint8_t j = 0; j < 3; j++) {
			_buf[(i * 4) + j] = _ascii[((s[i] - 32) * 3) + j];
		}
		_buf[(i * 4) + 3] = 0x00;
	}
}

void scroll_matrix(uint8_t red[], uint8_t grn[]) {
	static uint8_t x;
	
	for (uint8_t i = 0; i < 8; i++) {
		red[i] = _buf[x + i];
	}
	x++;
	if (x >= _l) x = 0;
}
